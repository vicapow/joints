<!DOCTYPE html>
<html>
  <style>
    body, html{ margin: 0;}
    .hud{
      position: absolute;
      left: 10px;
      top: 10px;
    }
    text{
      opacity: 0.4;
    }
  </style>
  <body>
  <div class="time"></div>
  <script src="d3.js"></script>
  <script src="dz.js"></script>
  <script>

var p = dz.projection.perspective()
  , pos = [0, 0, 4]
  , camera = p.camera().position(pos).focalLength(1).lookAt([0, 0, 1])
  , w = window.innerWidth
  , h = window.innerHeight
  , svg = d3.select('body').append('svg').attr({width: w, height: h})
  , max = Math.max(w, h), min = Math.min(w, h), diff = max - min
  // screen scaling
  , ranges = [ [0, max] , [ - diff / 2, max - diff / 2] ]
  , screenX = d3.scale.linear().domain([-1, 1]).range(ranges[w < h ? 1 : 0])
  , screenY = d3.scale.linear().domain([1, -1]).range(ranges[w > h ? 1 : 0])


var drag = d3.behavior.drag()
  .on('drag', function(d, i){
    var dx = d3.event.dx / w * Math.PI * 2
      , dy = d3.event.dy / h * Math.PI * 2
    pos = dz.matrix().rotateX(dy).rotateY(dx).multiVector(pos)
  })

svg.call(drag)

d3.csv('data.csv', function(d, i){
  if(i === 0) console.log(d)
  var body = {
      hand_left: [d.HandLeft_X, d.HandLeft_Y, d.HandLeft_Z, d.HandLeft_Status === 'Tracked']
    , wrist_left: [d.WristLeft_Y, d.WristLeft_Y, d.WristLeft_Z, d.WristLeft_Status === 'Tracked']
    , wrist_right: [d.WristRight_Y, d.WristRight_Y, d.WristRight_Z, d.WristRight_Status === 'Tracked']
    , hand_right: [d.HandRight_X, d.HandRight_Y, d.HandRight_Z, d.HandRight_Status === 'Tracked']
    , elbow_left: [d.ElbowLeft_X, d.ElbowLeft_Y, d.ElbowLeft_Z, d.ElbowLeft_Status === 'Tracked']
    , elbow_right: [d.ElbowRight_X, d.ElbowRight_Y, d.ElbowRight_Z, d.ElbowRight_Status === 'Tracked']
    , shoulder_center: [d.ShoulderCenter_X, d.ShoulderCenter_Y, d.ShoulderCenter_Z, d.ShoulderCenter_Status === 'Tracked']
    , shoulder_left: [d.ShoulderLeft_X, d.ShoulderLeft_Y, d.ShoulderLeft_Z, d.ShoulderLeft_Status === 'Tracked']
    , should_right: [d.ShoulderRight_X, d.ShoulderRight_Y, d.ShoulderRight_Z, d.ShoulderRight_Status === 'Tracked']
    , head: [d.Head_X, d.Head_Y, d.Head_Z, d.Head_Status === 'Tracked']
    , time: d.Time
  }
  var parts = Object.keys(body)
  parts.forEach(function(part){
    if(part === 'time') return
    body[part] = body[part].map(Number)
  })
  return body
}, function(err, data){
  if(err) throw err
  var parts = Object.keys(data[0])
    .filter(function(part){ return part !== 'time' })
  
  parts = svg.selectAll('g').data(parts).enter().append('g')

  parts.append('circle')
  parts.append('text').text(function(d){ return d })
    .attr('x', 10).attr('y', 10)

  var i = 0
  setInterval(function(){
    if(i >= data.length) i = 0
    var body = data[i++] // the current body part positions
    // d3.select('.time').text('' + body.time)
    camera.position(pos)
    parts.attr('transform', function(d){
        var x = screenX(p.x(body[d]))
        var y = screenY(p.y(body[d]))
        return 'translate(' + x + ',' + y + ')'
      })
      .select('circle').attr('r', function(d){ return p.scale(body[d]) * 20 })
    parts.select('text').text(function(d){ return d + ' : ' + (body[d][3] ? 'tracked' : 'inferred') })
  }, 10)
})

  </script>
  </body>
</html>